{{ template "_internal/google_analytics.html" . }}
<script>
(function () {
  var webSdkScript = document.createElement("script");
  webSdkScript.src = "https://unpkg.com/@grafana/faro-web-sdk@^1.0.0/dist/bundle/faro-web-sdk.iife.js";
  webSdkScript.onload = () => {
    window.GrafanaFaroWebSdk.initializeFaro({
      url: "https://faro-collector-prod-us-central-0.grafana.net/collect/d8b5652f5dd57fb1cfec9a1c32970fe0",
      app: {
        name: "docs.gomplate.ca",
        version: "1.0.0",
        environment: "production",
      },
      beforeSend: function(event) {
        const isLog = function(payload) {
          return payload.level !== undefined;
        };
        const isTrace = function(payload) {
          return payload.resourceSpans !== undefined;
        };

        if (isLog(event.payload)) {
          // add log context here
          event.payload.context = {
            someContext: 'thing',
          };
        } else if (isTrace(event.payload)) {
          // do something...although currently traces do not have a context/custom attribute property - could be useful to add?
          // maybe resourceSpans.resource.attributes?
          /* event.payload.resourceSpans.resource.attributes = {
            someAttribute: 'thing',
          }; */
          console.log('trace', event.payload);
        }
        return event;
      },
      user: {
        attributes: {
          baz: "qux",
        },
      },
    });

    // Load instrumentations at the onLoad event of the web-SDK and after the above configuration.
    // This is important because we need to ensure that the Web-SDK has been loaded and initialized before we add further instruments!
    var webTracingScript = document.createElement("script");

    webTracingScript.src = "https://unpkg.com/@grafana/faro-web-tracing@^1.0.0/dist/bundle/faro-web-tracing.iife.js";

    // Initialize, configure (if necessary) and add the the new instrumentation to the already loaded and configured Web-SDK.
    webTracingScript.onload = () => {
      window.GrafanaFaroWebSdk.faro.instrumentations.add(
        new window.GrafanaFaroWebTracing.TracingInstrumentation()
      );
    };

    // Append the Web Tracing script script tag to the HTML page
    document.head.appendChild(webTracingScript);
  };

  // Append the Web-SDK script script tag to the HTML page
  document.head.appendChild(webSdkScript);
})();
</script>
